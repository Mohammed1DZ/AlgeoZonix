{
  "entities": {
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to the Client who placed the order. (Relationship: Client 1:N Order)"
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time the order was submitted.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., 'Submitted', 'Processing', 'Shipped', 'Delivered')."
        },
        "details": {
          "type": "string",
          "description": "Detailed information about the order items, quantities, etc."
        }
      },
      "required": [
        "id",
        "clientId",
        "submissionDate",
        "status",
        "details"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client."
        },
        "name": {
          "type": "string",
          "description": "Full name of the client."
        },
        "email": {
          "type": "string",
          "description": "Email address of the client.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the client."
        },
        "address": {
          "type": "string",
          "description": "Address of the client."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phone",
        "address"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an admin user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin."
        },
        "name": {
          "type": "string",
          "description": "Full name of the admin."
        },
        "email": {
          "type": "string",
          "description": "Email address of the admin.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client profiles. Uses path-based ownership for private client data.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier of the client."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information. Includes denormalized 'clientId' field for authorization independence. Allows clients to only access their own orders, and admins to access all orders.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Marks a user as an administrator. The existence of a document in this collection grants admin privileges.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to address the 'auth/operation-not-allowed' error, enforce role-based access control (RBAC), and support the application's core features securely and scalably. The structure prioritizes Authorization Independence, enabling simple, robust, and easily debuggable security rules.\n\n**Authorization Independence:**\nThe design eliminates the need for `get()` calls in security rules by denormalizing authorization data. For example, client information is copied into the `orders` collection to avoid needing to fetch the client document when evaluating order access.\n\n**Structural Segregation:**\nData with different access requirements are stored in separate collections. Client data and admin data are segregated.\n\n**Access Modeling:**\n*   Private Data: Path-based ownership is employed for client data (`/clients/{clientId}`).\n*   Collaborative Data: Not directly applicable, but the approach could be extended to support collaborative orders in the future via membership maps.\n*   Global Roles: Admin status is determined by the existence of a document in the `/roles_admin/{uid}` collection.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by ensuring that each collection has a homogeneous security posture. For example, listing orders is secure because the security rules can efficiently filter orders based on the authenticated user's role and the denormalized `clientId` field.\n\n**Addressing the 'auth/operation-not-allowed' Error:**\nThe error suggests an issue with Firebase Authentication configuration or security rules. The following structure will allow for explicit security rules that can be easily debugged.\n\n**Denormalization Strategy:**\nIn the `/orders` collection, the `clientId` field from the `Client` document is copied into each `Order` document. This denormalization allows security rules to validate that a client can only access their own orders without needing to perform a `get()` operation to retrieve the client's ID. Furthermore the admin role check relies on collection existence."
  }
}